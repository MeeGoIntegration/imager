INSTALLATION

Full imager installation on one system.

Debian Squeeze:

cat >> /etc/apt/sources.list.d/mint << EOF
deb http://repo.pub.meego.com/Project:/MINT:/Testing/Debian_6.0/ /
EOF

apt-get uodate

apt-get install boss boss-viewer img-web

MIC
change /etc/mic2/mic2.conf according to your needs, for example proxy.

PARTICIPANTS

cat >> /etc/sudoers.d/nobody << EOF
nobody ALL=(ALL)NOPASSWD:/usr/bin/mic-image-creator
EOF

chmod 0440 /etc/sudoers.d/nobody

mkdir /var/www/images
mkdir /var/www/templates/
chmod 0777 /var/www/images

for i in build_image build_ks update_image_status request_image ; do 
  skynet enable $i
  skynet register -n $i
done

WEB

Edit /etc/imager/img.conf and set the database and boss settings.


mysql -u root -p

create database imgdb CHARACTER SET utf8;

GRANT ALL ON imgdb.* TO 'img'@'localhost' IDENTIFIED BY 'img';

django-admin  syncdb --settings=img_web.settings

django-admin  collectstatic --settings=img_web.settings

cat >> /etc/lighttpd/vhosts.d/img.conf << EOF
var.namebasedir = "/img"

$HTTP["url"] =~ "^" + namebasedir {
        dir-listing.activate = "disable"
}

url.redirect += (
  "^" + namebasedir + "$" => namebasedir + "/"
)

fastcgi.server += (
    "/img.fcgi" => (
        "main" => (
            "socket" => "/var/run/img_web" + ".socket",
            "check-local" => "disable",
        )
    ),
)

url.rewrite-if-not-file += (
   "^(" + namebasedir + "/.*)$" => "/img.fcgi/$1"

EOF


Edit /etc/lighttpd/lighttpd.conf and enable mod_rewrite and add the following line at the end

include_shell "cat /etc/lighttpd/vhosts.d/*"

lighttpd-enable-mod fastcgi
lighttpd-enable-mod accesslog

/etc/init.d/lighttpd force-reload

Point your browser at http://127.0.0.1/img/
